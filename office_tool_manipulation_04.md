# シートの参照

目的: シート間のセル参照の方法を学ぶ

## 1 別のシートを参照する

### 1.1 店の表を作成する

RPGの世界にはさまざまな店があり、大抵は店によって扱う商品が異なります。ゲームの仕様には、これらの店のデータも含めなくてはなりません。

当然ながら、店に必要なデータはゲーム内容によって異なります。多くのゲームでは「店名」のようなものはなく、単に「武器屋」とか「道具屋」のような種類があるだけです。ですが、種類だけでは店を特定できません。そこで、店番号や店の所在地といったデータによって、各店舗を識別します。

それでは、店のデータを作っていきましょう。まずは店用のシートを追加し、見出しを入力してください。

<pre class="tnmai_assignment">
<strong>【課題１】</strong>
シートを追加して、追加したシートの名前を「店」に変更しなさい。
</pre>

<pre class="tnmai_assignment">
<strong>【課題２】</strong>
「店」シートのA1からK1セルに、次の見出しを入力しなさい。
  A1: 店番号
  B1: マップ名
  C1: 種類
  D1: 価格
  E1: 商品１
  F1: 商品２
  G1: 商品３
  H1: 商品４
  I1: 商品５
  J1: 商品６
  K1: 商品７
</pre>

<pre class="tnmai_assignment">
<strong>【課題３】</strong>
C2～C23セルの範囲に、入力規則のリストを設定しなさい。リストの値は次の4種類とします。
  武器と防具
  鍵
  聖水
  宿
</pre>

<pre class="tnmai_assignment">
<strong>【課題４】</strong>
B2～B23セルの範囲に、入力規則のリストを設定しなさい。
リストの値には、「日本の家庭用ゲーム機で初めて発売されたコマンド式RPG」の「マップ名」をインターネットで検索して使用すること。
</pre>

### 1.2 リスト入力条件に表を使う

入力条件のリストには、単語だけでなく、Excelの表を使うこともできます。そこで、店の商品を「アイテム」シートから選択できるようにしましょう。

表を選択するには数式、つまり`=`(イコール)を使います。次の手順に

1. 「店」シートのE2セル(商品1のすぐ下)をアクティブセルにする
2. 「データ」タブ、「データの入力規則」の順にクリック
3. 設定ウィンドウで「リスト」を選択
4. 「元の値」に`=アイテム!B2:B35`と入力(英数と記号はすべて半角)
5. 「OK」をクリック

この手順4では、セル参照に「シート参照」と「範囲参照」を使っています。

| 参照方法 | 効果 | 例 |
|:-------:|:-----|:--:|
| シート参照 | シート名の直後に`!`記号を書く | Sheet! |
| 範囲参照 | 範囲の左上と右下のセル名を`:`記号でつなぐ | A2:D5 |

入力規則を設定できたら、`v`ボタンをクリックしてリストを確認してください。「アイテム」シートの「名前」列にある単語が表示されていたら成功です。

### 1.3 無効なデータの扱い

商品は1～7まで最大7つまで設定できますが、店によっては2つか3つしか商品がない場合もあるでしょう。

ここで問題になるのは、「商品がない」ことを表現する方法です。「入力条件を設定せずに空欄のままにする」方法もありますが、これでは「商品がない」と「入力を忘れた」のどちらなのか判断できません。

そこで、「アイテム」シートに「商品なし」というアイテムを追加することにします。以下の手順に従って、「商品なし」をあらわすデータを追加してください。

1. 「アイテム」シートを選択
2. 「番号」列の一番下の空欄に、「上のセルの番号+1」を入力。このとき、テーブルが自動的に大きくなります。
3. 増えた行の「名前」列に`-`(マイナス)記号を入力

それから、増やしたデータをリストに反映する必要があります。

1. 「店」シートを選択
2. E2セルをアクティブセルにする
3. 「データ」タブ、「データの入力規則」の順にクリック
4. リスト設定の「元の値」を`=アイテム!B2:B35`に変更
5. 「OK」をクリック

設定が完了したら、E2セルの`v`ボタンをクリックして、リストに「(なし)」が追加されていることを確認してください。

### 1.4 相対参照と絶対参照

オートセルを使って、E2セルの内容を商品２から商品７まで、コピーしてください。

これですべての商品に入力規則が設定されたはずです。E3セルの`v`ボタンをクリックして、リストを見てみましょう。すると、名前ではなく数字のリストが表示されます。

E3セルをクリックし、「データ」タブの「データの入力規則」を選んでリスト設定を確認してください。すると、「元の値】の範囲参照の部分が`C2:C35`になっていると思います。

これは、通常のセル参照が「相対参照(そうたいさんしょう)」になっているからです。

「相対参照」は、数式をコピーしたときに「コピー元のセル位置を基準として、参照先を自動的に調整する」機能です。

例えば、あるセルがB2セルを相対参照している場合、内容を右のセルにコピーすると、C2セルを参照するように調整されます。同様に、下のセルにコピーすると、B3セルを参照するように調整されます。

相対参照のコピー:

| =B2 | → | =C2 |
|:---:|:-------------:|:---:|
| **↓** | **↘** | |
| **=B3** | | **=C3** |

コピーしたときに参照先を変えたくない場合は「絶対参照(ぜったいさんしょう)」を使います。使い方は簡単で、行番号と列番号の前に`$`(ドル記号)を付けるだけです。

絶対参照のコピー:

| =$B$2 | → | =$B$2 |
|:---:|:-------------:|:---:|
| **↓** | **↘** | |
| **=$B$2** | | **=$B$2** |

それでは、絶対参照を使ってリストの表示を修正しましょう。

1. E2～K2セルを選択範囲にする
2. 「データ」タブ、「データの入力規則」の順にクリック
3. 警告ウィンドウが出るので「OK」をクリック
4. 設定画面で「リスト」を選択
5. 「元の値」に`=アイテム!$B$2:$B$34`を入力
6. 「OK」をクリック

設定が完了したら、E3セルの`v`ボタンをクリックして、数値ではなくアイテム名が表示されることを確認してください。

<pre class="tnmai_assignment">
<strong>【課題５】</strong>
「日本の家庭用ゲーム機で初めて発売されたコマンド式RPG」の「店」のデータをインターネットで検索し、
マップ名、種類、商品を表に入力しなさい。

同じマップに同じ種類の店が複数ある場合、それぞれの店を別の行に入力すること。
例えば、「ドールの街」というマップに種類「道具」の店が3つある場合、「ドールの街」「道具」という行を3行にわたって入力します。

店の種類が「聖水」、「鍵」、「宿」のいずれかの場合、「価格」列に商品の値段(または宿泊費)を入力すること。
</pre>
